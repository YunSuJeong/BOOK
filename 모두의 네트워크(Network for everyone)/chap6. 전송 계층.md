# 전송 계층 : 신뢰할 수 있는 데이터 전송하기
> review. 네트워크 계층은 다른 네트워크로 데이터를 전송하는 계층이며 라우터의 라우팅 기능을 사용하여 전송할 수 있다고 설명함.

## LESSON23. 전송계층의 역할
- 목적지에 **신뢰할 수 있는 데이터를 전달**하기 위해 필요
- 물리/데이터링크/네트워크 계층은 데이터가 손상되거나 유실되더라도 아무것도 해주지 않는다.!
  - 네트워크 계층 : 목적지까지 데이터를 전달
  - 전송 계층 : 데이터가 제대로 도착했는지 확인
- **오류를 점검하는 기능**이 존재 : 오류가 발생하면 **데이터를 재전송**하도록 요청
- 전송된 데이터의 **목적지가 어떤 애플리케이션인지 식별**하는 기능

### 전송계층의 특징 
- 신뢰성/정확성 : 데이터를 목적지에 문제없이 전달하는 것
- 효율성 : 데이터를 빠르고 효율적으로 전달하는 것

### 연결형 통신과 비연결형 통신
![연결형/비연결형](https://velog.velcdn.com/images/miso1489/post/2042908d-7135-437a-b723-efc38a8eca02/image.png)
- **연결형 통신**
  - 신뢰할 수 있고 정확한 데이터를 전달하는 통신
  - 상대편과 확인해가면서 통신하는 방식
  - TCP(Transmission Control Protocol)
- **비연결형 통신**
  - 효율적으로 데이터를 전달하는 통신
  - 상대편을 확인하지 않고 일방적으로 데이터를 전송하는 방식 (확인절차X)
  - ex. 동영상 시청
  - UDP(User Datagram Protocol)
  
## LESSON24. TCP의 구조
> review.  
> 캡슐화 : 응용 계층부터 물리 계층까지 계층별로 데이터를 전달할 때, 헤더를 붙이는 것  
> 역캡슐화 : 데이터 수신 측에서 물리 계층부터 응용 계층까지 계층별로 데이터를 전달할 때, 헤더를 제거하는 것

### TCP란?
- 신뢰성과 정확성을 우선으로 하는 연결형 통신 프로토콜
- **TCP 데이터 구조**
![TCP헤더](https://velog.velcdn.com/images/sunnamgung8/post/2f6095d6-6e0d-42aa-8595-701e9844bb56/image.png)
  - TCP헤더 : TCP로 전송할 때 붙이는 헤더
  - 세그먼트(segment) : TCP헤더가 붙은 데이터
- **연결(connection, 커넥션)**
  - 연결형 통신에서 데이터를 전송하기 전에 해야하는 작업
  - TCP통신에서 정보를 전달하기 위해 사용되는 가상의 통신로
  - 연결을 확립한 후, 데이터를 전송할 수 있다.!
  ![연결확립을 위한 값](https://velog.velcdn.com/images/sunnamgung8/post/6b6e7f5c-a22b-4535-ab37-3861f76ab320/image.png)
  - 코트 비트 : 연결을 위한 제어정보가 기록되는 곳
      - 초깃값 = 0, 활성화 = 1
      - 연결 확립을 위해 **SYN(씬, 연결요청) & ACK(에크, 확인응답)** 필요

### 3-way 핸드셰이크
- 데이터를 보내기 전에 연결을 확립하기 위해 패킷요청을 세번 교환하는 것
![연결확립과정](https://velog.velcdn.com/images/sunnamgung8/post/f2e50e1d-e559-4e99-a514-3ca024c5725b/image.png)
  - 컴퓨터1 : 연결 확립 허가를 받기 위한 요청(SYN)을 보낸다.  
  - 컴퓨터2 : 허가한다는 응답을 회신하기 위해 연결 확립 응답(ACK) + 컴1에게 데이터 전송허가를 받기위해 연결확립 요청(SYN)을 보낸다.
  - 컴퓨터1 : 컴2에게 허가한다는 응답으로 연결 확립 응답(ACK)을 보낸다.
  ![3-way핸드셰이크](https://github.com/YunSuJeong/BOOK/assets/91771574/db2419ad-9932-4d9a-af47-00f8505a8107)

### 연결 끊기 과정
- 데이터를 전송한 후에는 연결을 끊기 위한 요청을 교환해야한다.
- **FIN(연결 종료) & ACK** 사용
![연결종료](https://velog.velcdn.com/images/sunnamgung8/post/22e70bf3-7117-46ee-a6be-12f3fd384c74/image.png)
  - 컴퓨터1 : 연결 종료 요청(FIN)을 보낸다.
  - 컴퓨터2 : 연결 종료 응답(ACK)을 반환한다.
  - 컴퓨터2 : 연결 종료 요청(FIN)을 보낸다.
  - 컴퓨터1 : 연결 종료 응답(ACK)을 반환한다.
![연결종료](https://github.com/YunSuJeong/BOOK/assets/91771574/c24b4893-2e4f-4657-bcd2-5895e7735a08)

## LESSON25. 일련번호와 확인 응답 번호의 구조
### 일련번호&응답번호
![이미지](https://velog.velcdn.com/images/sunnamgung8/post/e88b0f94-359c-42b7-a368-90cefad1f0e7/image.png)
- 3-way 핸드셰이크가 끝나고 실제 데이터를 보내거나 상대방이 받을 때 사용하는 비트
- **일련번호**
  - 데이터를 분할해서 보낼 때, 송신 측에서 수신측으로 데이터가 몇번째 데이터인지 알려주는 역할
- **확인 응답 번호**
  - 수신 측이 몇 번째 데이터를 수신했는지 송신측에 알려주는 역할
  - 다음번호의 데이터를 요청하는데도 사용됨
  - 수신한 일련번호 + 데이터 크기 -> 송신측으로 전달함
- **재전송 제어**
  - 일려번호/확인 응답 번호를 사용해서 데이터가 손상되거나 유실된 경우에 데이터를 재전송하는 것
  - 데이터 전송중 오류가 발생하면 일정 시간 동안 대기한 후에 재전송 

### 윈도우 크기란?
> 위에서 설명한 한번 보낼 때마다 한번 응답을 반환하는 방식은 효율이 높지않다.!
- 매번 확인 응답을 기다리는 대신 세그먼트를 연속해서 보내고 난 다음 확인 응답을 반환하면 효율이 높아진다!
  - 버퍼(buffer) : 받은 세그먼트를 일시적으로 보관하는 장소
- 오버플로(overflow)
  - 수신 측에서 대량의 데이터를 보관하지 못하고 넘치는 것
- 윈도우 크기(window size)
  - 버퍼의 한계 크기
  - 얼마나 많은 용량의 데이터를 저장해 둘 수 있는지
  - 오버플로가 발생하지 않도록 하는 역할
  - 초깃값은 3-way 핸드셰이크 할 때 정해진다.
![초깃값](https://velog.velcdn.com/images/sunnamgung8/post/2c2d72ac-d3b0-4aff-aaef-640f0a2aaccd/image.png)
    
## LESSON26. 포트 번호의 구조
### 포트 번호란?
- 어떤 애플리케이션인지 구분하는 역할
![포트번호](https://velog.velcdn.com/images/sunnamgung8/post/efd65a5f-430a-4484-a2e9-41faab1fcc1d/image.png)
- 0~65535번 사용가능
  - 0~1023 : 주요 프로토콜이 사용하도록 예약되어있음, '잘 알려진 포트', 일반적으로 사용하는 서버 측 애플리케이션에서 사용
      - SSH(22), SMTP(25), DNS(53), HTTP(80), POP3(110), HTTPS(443)
  - 1024 : 예약되어있지만 사용하지 않는 포트
  - 1025~ : 랜덤 포트, 클라이언트 측의 송신 포트로 사용
> Point!  
> 데이터를 전송할 때는 상대방의 IP주소가 필요하지만, 어떤 애플리케이션이 사용되고 있는지 구분하려면 TCP는 포트번호가 필요하다!

## LESSON27. UDP의 구조
### UDP란?
- 데이터를 효율적이고 빠르게 보낼 때 사용되는 비연결형 통신 프로토콜
- 효율성과 빠른 속도가 중요하여 사대방을 확인하지 않고 연속해서 데이터를 보냄
- 랜에 있는 컴퓨터나 네트워크 장비에 데이터를 일괄로 보낼 수 있다 = **브로드캐스트(broadcast)**
- UDP헤더
![UDP헤더](https://velog.velcdn.com/images/sunnamgung8/post/ff29b53c-b497-497a-b11b-df61b21e3420/image.png)
  - UDP데이터그램 : UDP헤더가 붙은 데이터


